
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>Promethues and Kubernetes - OpsMx ISD Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#00bdd6">
        
      
      
  
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11 15h2v2h-2v-2m0-8h2v6h-2V7m1-5C6.47 2 2 6.5 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2m0 18a8 8 0 0 1-8-8 8 8 0 0 1 8-8 8 8 0 0 1 8 8 8 8 0 0 1-8 8Z"/></svg>');}</style>

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-240811344-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="cyan" data-md-color-accent="cyan">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#promethues-and-kubernetes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="OpsMx ISD Documentation" class="md-header__button md-logo" aria-label="OpsMx ISD Documentation" data-md-component="logo">
      
  <img src="../logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OpsMx ISD Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Promethues and Kubernetes
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/Somasekhar-nakkala/Somasekhar-nakkala.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Somasekhar-nakkala/Somasekhar-nakkala.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="OpsMx ISD Documentation" class="md-nav__button md-logo" aria-label="OpsMx ISD Documentation" data-md-component="logo">
      
  <img src="../logo.svg" alt="logo">

    </a>
    OpsMx ISD Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Somasekhar-nakkala/Somasekhar-nakkala.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Somasekhar-nakkala/Somasekhar-nakkala.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Overview
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Overview" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Overview
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../OpsMx%20Intelligent%20Software%20Delivery%20Platform/" class="md-nav__link">
        OpsMx Intelligent Software Delivery Platform
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Orchestration%20Module%20-%20OpsMx%20Enterprise%20for%20Spinnaker%20%28OES%29/" class="md-nav__link">
        Orchestration Module   OpsMx Enterprise for Spinnaker (OES)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../OES%20Features/" class="md-nav__link">
        OES Features
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Automated%20Workflows/" class="md-nav__link">
        Automated Workflows
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Multi-cloud%20Deployments/" class="md-nav__link">
        Multi cloud Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Safe-Deployment%20strategies/" class="md-nav__link">
        Safe Deployment strategies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Scalable%20%26%20Extensible/" class="md-nav__link">
        Scalable & Extensible
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../OES%20Concepts/" class="md-nav__link">
        OES Concepts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Application%20Management/" class="md-nav__link">
        Application Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Application%20Deployment/" class="md-nav__link">
        Application Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Data%20and%20Intelligence%20Module%20-%20Autopilot/" class="md-nav__link">
        Data and Intelligence Module   Autopilot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Observability/" class="md-nav__link">
        Observability
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Audit%20and%20Traceability/" class="md-nav__link">
        Audit and Traceability
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Continuous%20Compliance%20-%20Policy/" class="md-nav__link">
        Continuous Compliance   Policy
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ISD%20Quick%20Installation/" class="md-nav__link">
        ISD Quick Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Trial%20User%20Guide/" class="md-nav__link">
        Trial User Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../SaaS%20Trial%20Usage%20Instruction%20Video/" class="md-nav__link">
        SaaS Trial Usage Instruction Video
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Operator Manual
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Operator Manual" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Operator Manual
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ISD%20Architecture/" class="md-nav__link">
        ISD Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ISD%20Deployment%20Architecture/" class="md-nav__link">
        ISD Deployment Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Environment%20setup%20for%20OpsMx%20ISD/" class="md-nav__link">
        Environment setup for OpsMx ISD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ISD%20On-Prem%20POV%20Infrastructure%20requirements/" class="md-nav__link">
        ISD On Prem POV Infrastructure requirements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ISD%20Installation%20Guide/" class="md-nav__link">
        ISD Installation Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ISD%20GitOps%20Installation/" class="md-nav__link">
        ISD GitOps Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ISD%20Installation%20Configuration/" class="md-nav__link">
        ISD Installation Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Helm%20Chart%20based%20installation/" class="md-nav__link">
        Helm Chart based installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ISD%20Installation%20on%20OpenShift/" class="md-nav__link">
        ISD Installation on OpenShift
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Autopilot%20Installation/" class="md-nav__link">
        Autopilot Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Routing%20Web%20URLs%20to%20ISD%20services/" class="md-nav__link">
        Routing Web URLs to ISD services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ISD%20Service%20Catalogue/" class="md-nav__link">
        ISD Service Catalogue
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ISD%20-%20Commonly%20used%20Commands/" class="md-nav__link">
        ISD   Commonly used Commands
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Promethues and Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Promethues and Kubernetes
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-do-automated-canary-analysis-for-kubernetes-and-prometheus" class="md-nav__link">
    How to do Automated Canary Analysis for Kubernetes and Prometheus
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#background" class="md-nav__link">
    Background:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#steps-to-enable-kayenta-for-kubernetes-and-prometheus" class="md-nav__link">
    Steps to Enable Kayenta for Kubernetes and Prometheus
  </a>
  
    <nav class="md-nav" aria-label="Steps to Enable Kayenta for Kubernetes and Prometheus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-enable-canary" class="md-nav__link">
    Step 1: Enable Canary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-enable-storage-for-canary" class="md-nav__link">
    Step 2: Enable Storage for Canary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-enable-prometheus-monitoring-service-integration" class="md-nav__link">
    Step 3: Enable Prometheus Monitoring Service Integration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-create-canary-config" class="md-nav__link">
    Step 4: Create Canary Config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-run-the-pipeline-get-scores-and-review-the-scores" class="md-nav__link">
    Step 5: Run the pipeline / Get scores and Review the scores
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          User Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Application%20Dashboard/" class="md-nav__link">
        Application Dashboard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Application%20Service%20View/" class="md-nav__link">
        Application Service View
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Manage%20Application/" class="md-nav__link">
        Manage Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Create%20an%20Application/" class="md-nav__link">
        Create an Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Configure%20an%20Application/" class="md-nav__link">
        Configure an Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Delete%20an%20Application/" class="md-nav__link">
        Delete an Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Create%20a%20Pipeline/" class="md-nav__link">
        Create a Pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Add%20Stage/" class="md-nav__link">
        Add Stage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Add%20Trigger/" class="md-nav__link">
        Add Trigger
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Edit%20Pipeline/" class="md-nav__link">
        Edit Pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Rename%20Pipeline/" class="md-nav__link">
        Rename Pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Delete%20Pipeline/" class="md-nav__link">
        Delete Pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Disable%20Pipeline/" class="md-nav__link">
        Disable Pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Lock%20Pipeline/" class="md-nav__link">
        Lock Pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../View%20and%20Restore%20Pipeline/" class="md-nav__link">
        View and Restore Pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Approval%20Gate/" class="md-nav__link">
        Approval Gate
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-do-automated-canary-analysis-for-kubernetes-and-prometheus" class="md-nav__link">
    How to do Automated Canary Analysis for Kubernetes and Prometheus
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#background" class="md-nav__link">
    Background:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#steps-to-enable-kayenta-for-kubernetes-and-prometheus" class="md-nav__link">
    Steps to Enable Kayenta for Kubernetes and Prometheus
  </a>
  
    <nav class="md-nav" aria-label="Steps to Enable Kayenta for Kubernetes and Prometheus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-enable-canary" class="md-nav__link">
    Step 1: Enable Canary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-enable-storage-for-canary" class="md-nav__link">
    Step 2: Enable Storage for Canary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-enable-prometheus-monitoring-service-integration" class="md-nav__link">
    Step 3: Enable Prometheus Monitoring Service Integration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-create-canary-config" class="md-nav__link">
    Step 4: Create Canary Config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-run-the-pipeline-get-scores-and-review-the-scores" class="md-nav__link">
    Step 5: Run the pipeline / Get scores and Review the scores
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/Somasekhar-nakkala/Somasekhar-nakkala.github.io/edit/master/docs/Promethues and Kubernetes.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="promethues-and-kubernetes"><strong>Promethues and Kubernetes</strong></h1>
<h2 id="how-to-do-automated-canary-analysis-for-kubernetes-and-prometheus"><strong>How to do Automated Canary Analysis for Kubernetes and Prometheus</strong></h2>
<p>Spinnaker automated canary analysis tool (<a href="https://cloud.google.com/blog/products/gcp/introducing-kayenta-an-open-automated-canary-analysis-tool-from-google-and-netflix">Kayenta</a>) has been available starting with version 1.7. In this blog we will cover how to setup Kayenta for a Kubernetes provider with Prometheus being used for monitoring.</p>
<h2 id="background"><strong>Background:</strong></h2>
<p>Canary deployments has been one of the best practices in the software delivery for some time now. 
The reason for doing Canary deployment is to reduce the risk of introducing new update with issues 
to 100 % of the customers like American Airline did and 
resulted in <a href="https://qz.com/393909/american-airlines-planes-are-grounded-because-their-pilots-ipads-have-crashed/">all their airplanes grounded for 6 hours</a>.</p>
<p>Automated canary analysis is way to use automation to detecting issues with the new software using 
the metrics generated by the new application and comparing to the current production version. 
Netflix and Google has teamed up to release an open source version of this analysis tool called 
Kayenta and make it available as part of the Spinnaker project. Note that the Kayenta architecture is 
designed in a modular fashion allowing for use of 3rd party or custom judges created by the users. 
For more information about Kayenta architecture, <a href="https://www.youtube.com/watch?v=K22lyoopRxk">watch</a> the 
recent meetup from the architect of Kayenta</p>
<h2 id="steps-to-enable-kayenta-for-kubernetes-and-prometheus"><strong>Steps to Enable Kayenta for Kubernetes and Prometheus</strong></h2>
<p>Kayenta supports the following monitoring services - Stackdriver, Prometheus and DataDog. You can deploy Kayenta to Kubernetes running on AWS. In our case, we have Spinnaker instance deploying to Kubernetes running on AWS. Prometheus is the monitoring service used for service level metrics monitoring (Tomcat service).</p>
<p>Let’s begin</p>
<h3 id="step-1-enable-canary"><strong>Step 1: Enable Canary</strong></h3>
<p>Ensure that you are running 1.7 or later version of the Spinnaker software. You can use the following command to ve rify your spinnaker version.</p>
<div class="highlight"><pre><span></span><code>hal config version
</code></pre></div>
<p>If you are running prior version, make sure you upgrade the version to the latest version and try again. You can use the following command.</p>
<div class="highlight"><pre><span></span><code>hal config version edit --version 1.7.6
</code></pre></div>
<p>Then use the below command to enable Canary analysis option for all applications. You can turn off canary availability option for individual applications as desired.</p>
<div class="highlight"><pre><span></span><code>hal config canary enable
</code></pre></div>
<h3 id="step-2-enable-storage-for-canary"><strong>Step 2: Enable Storage for Canary</strong></h3>
<p>Canary needs a storage account to store the canary data such as canary configurations and time series data retrieved from metric stores. If you need help configuring a storage account, check <a href="https://spinnaker.io/docs/setup/install/storage/">documentation</a>.</p>
<p>Enable the default storage account with the following command.</p>
<div class="highlight"><pre><span></span><code>hal config canary edit --default-storage-account ACCOUNTName --bucket StorageBucketName --root-folder RootFolderlName
</code></pre></div>
<p>For example:</p>
<div class="highlight"><pre><span></span><code>hal config canary edit --default-storage-account aws-s3-kayenta --bucket kayentasetup --root-folder kayenta
</code></pre></div>
<h3 id="step-3-enable-prometheus-monitoring-service-integration"><strong>Step 3: Enable Prometheus Monitoring Service Integration</strong></h3>
<p>Next, we have to enable for Kayenta to able to read Prometheus metric store. Authentication for prometheus is not enabled in the given example. However, it can be setup easily if authentication at Prometheus is enabled. Use the following command to enable Prometheus metric store</p>
<div class="highlight"><pre><span></span><code>hal config canary prometheus enable
</code></pre></div>
<div class="highlight"><pre><span></span><code>hal config canary prometheus account add ACCOUNTName --base-url ENDPointOfPrometheus
</code></pre></div>
<p>For example:</p>
<div class="highlight"><pre><span></span><code>hal config canary prometheus account add prometheus-account --base-url http://a23f9cc3537ee12345678910-655574421.us-east-2.elb.amazonaws.com:9090 
</code></pre></div>
<div class="highlight"><pre><span></span><code>hal config canary edit --default-metric-account ACCOUNTName
</code></pre></div>
<p>For example:</p>
<div class="highlight"><pre><span></span><code>hal config canary edit --default-metric-account prometheus-account
</code></pre></div>
<h3 id="step-4-create-canary-config"><strong>Step 4: Create Canary Config</strong></h3>
<p>Add canary config in the form of metric template of your monitoring data store (Prometheus)</p>
<p>Click on canary config page under delivery tab on application tab as shown below. (Image-1)</p>
<figure>
<p><img align="center" alt="Canary_configs_page" src="../Canary_configs_page.png" />
  </p>
<figcaption>Image-1</figcaption>
</figure>
<p>After that, click on ‘<strong>Add Configuration</strong>’, ‘Add configuration name and description’.</p>
<p>Click on ‘<strong>Add Metric</strong>’, which will result in a pop-up as shown below. </p>
<figure>
<p><img align="center" alt="Canary_configs_page" src="../Add_metric.png" />
  </p>
<figcaption>Image-2</figcaption>
</figure>
<p><strong>Add Name and Metric name:</strong> We need to add a filter template in the case of kubernete cluster because pod names are saved in the format - container_label_{your pod name} in the Prometheus server. So for the filter template, be sure to attach the “container_label_” string before your pod name which you will give in the canary analysis stage in pipeline and spinnaker will use internally to query metric data from the Prometheus server. </p>
<p>Label Bindings are another way to filter metrics for aggregation. Internally, if the query to Prometheus results in more than one metric (due to multiple tags/dimensions that match metric name) then they are averaged to form one series of data.</p>
<p>Labels allow filtering to support only the required tags to be used in generating metric time series. This is also a simple way to utilize labels assigned to Kubernetes pods to select in metric time series query. In summary, before adding anything in this pop up template, Add template in filter templates button (image-1) and then come to this pop up, configure metric and attached filter template. </p>
<p><strong>Direction:</strong> Customize for change in higher or lower values. For example, measuring throughput, higher is acceptable, however, for latency lower is acceptable Filter templates allow customization of metrics to use in canary analysis. Some implicit binding variables available in filter templates are scope, project, location, and resource Type. 
Filter templates allow literal bindings along with variable bindings. For example, in Prometheus metrics, if only cpu idle time is of interest then a literal filter can be set to filter only idle time and not utilization. Another example is when the canary comparison is using a single pod and not the entire server group then the filter can be specified as shown in image-3.</p>
<p>Click on <strong>Add template</strong> under filter template section on canary configuration.</p>
<figure>
<p><img align="center" alt="Canary_configs_page" src="../Add_template.png" />
  </p>
<figcaption>Image-3</figcaption>
</figure>
<p>${scope} will fill with baseline and canary version dynamically i.e. pod name of your Kubernetes cluster. Now you are done with the canary configuration.</p>
<figure>
<p><img align="center" alt="Canary_configs_page" src="../Canary_analysis_config1.png" />
  </p>
<figcaption>Image-4</figcaption>
</figure>
<figure>
<p><img align="center" alt="Canary_configs_page" src="../Canary_analysis_config2.png" />
  </p>
<figcaption>Image-5</figcaption>
</figure>
<figure>
<p><img align="center" alt="Canary_configs_page" src="../Canary_analysis_config3.png" />
  </p>
<figcaption>Image-6</figcaption>
</figure>
<h3 id="step-5-run-the-pipeline-get-scores-and-review-the-scores"><strong>Step 5: Run the pipeline / Get scores and Review the scores</strong></h3>
<p>Over ‘Canary reports’ tab, under the ‘delivery tab’ on application page one can see the reports of metrics which we configured in the canary config.</p>
<figure>
<p><img align="center" alt="Canary_configs_page" src="../Canary_reports1.png" />
  </p>
<figcaption>Image-7</figcaption>
</figure>
<figure>
<p><img align="center" alt="Canary_configs_page" src="../Canary_reports2.png" />
  </p>
<figcaption>Image-8</figcaption>
</figure>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../ISD%20-%20Commonly%20used%20Commands/" class="md-footer__link md-footer__link--prev" aria-label="Previous: ISD   Commonly used Commands" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              ISD   Commonly used Commands
            </div>
          </div>
        </a>
      
      
        
        <a href="../Application%20Dashboard/" class="md-footer__link md-footer__link--next" aria-label="Next: Application Dashboard" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Application Dashboard
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2022 All Rights Reserved <script>document.write</script>
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://twitter.com/ops_mx" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.facebook.com/OpsMxInc/" target="_blank" rel="noopener" title="www.facebook.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.linkedin.com/company/opsmx/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.youtube.com/channel/UCFIqwYzo-2LGShQCVFy9LWg" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
        <script src="../javascripts/feedback.js"></script>
      
    
  </body>
</html>